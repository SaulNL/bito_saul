<app-header message="Estadísticas" [backButton]="false" [closeButton]="true" (closeResponse)="closeStatistic()">
</app-header>
<app-loader [loader]="loading" message="Cargando estadísticas del negocio"></app-loader>

<ion-content fullscreen *ngIf="!loading"> 
    <div class="filters">
        <ion-item style="width: 49%;">
            <ion-label>Fecha: </ion-label>
            <ion-select value="{{ selected }}" ok-text="Ok" cancel-text="Cancelar" (ionChange)="activetedFilter($event.detail.value)">
                <ion-select-option value="day">
                    <ion-icon name="calendar-outline"></ion-icon>
                    Hoy
                </ion-select-option>
                <ion-select-option value="week">
                    <ion-icon name="calendar-outline"></ion-icon>
                    Últimos 7 días
                </ion-select-option>
                <ion-select-option value="month">
                    <ion-icon name="calendar-outline"></ion-icon>
                    Últimos 30 días
                </ion-select-option>
                <ion-select-option value="all">
                    <ion-icon name="sparkles-outline"></ion-icon>
                    Todo
                </ion-select-option>
            </ion-select>
        </ion-item>
        <ion-item style="width: 49%;">
            <ion-label>Filtrar por: </ion-label>
            <ion-select value="{{ selectedPlus }}" ok-text="Ok" cancel-text="Cancelar" (ionChange)="filtroPlus($event.detail.value)">
                <ion-select-option value="edad">
                    <ion-icon name="calendar-outline"></ion-icon>
                    Edad
                </ion-select-option>
                <ion-select-option value="sexo">
                    <ion-icon name="calendar-outline"></ion-icon>
                    Sexo
                </ion-select-option>
                <ion-select-option value="localidad">
                    <ion-icon name="calendar-outline"></ion-icon>
                    Localidad
                </ion-select-option>
                <ion-select-option value="todos">
                    <ion-icon name="sparkles-outline"></ion-icon>
                    Todo
                </ion-select-option>                
            </ion-select>        
        </ion-item>
    </div>
    <div *ngIf="features16; else noSuscription">        
        <ion-card>
            <ion-card-content>
                <ion-grid>
                    <ion-row>
                        <ion-col>
                            <ion-card>
                                <ion-card-content class="background-deeppink">
                                    <ion-grid class="ion-text-center">
                                        <h2 class="text-white">
                                            Visitas <ion-icon name="information-circle-outline" (click)="visists(null)">
                                            </ion-icon>
                                        </h2>
                                        <h1 class="text-white">
                                            <strong>
                                                {{totalVisitsQrAndUrl}}
                                            </strong>
                                        </h1>
                                    </ion-grid>
                                </ion-card-content>
                            </ion-card>
                        </ion-col>
                        <ion-col>
                            <ion-card>
                                <ion-card-content class="background-deeppink">
                                    <ion-grid class="ion-text-center">
                                        <h2 class="text-white">
                                            Likes negocio
                                        </h2>
                                        <h1 class="text-white">
                                            <strong>
                                                {{ this.statistics.totalLikesBusiness }}
                                            </strong>
                                        </h1>
                                    </ion-grid>
                                </ion-card-content>
                            </ion-card>
                        </ion-col>
                        <ion-col>
                            <ion-card>
                                <ion-card-content class="background-blueviolet">
                                    <ion-grid class="ion-text-center">
                                        <h2 class="text-white">
                                            Requerimientos de compra
                                        </h2>
                                        <h1 class="text-white" *ngIf="requests.length < 1; else elseBlock">
                                            <strong ><!--{{ requests.length statistics.totalRequests}}-->  
                                                0                                              
                                            </strong>                                            
                                        </h1>
                                        <ng-template #elseBlock>
                                            <h2>
                                                <strong>
                                                    {{ requests.length }}
                                                </strong>                                                
                                            </h2>                                               
                                        </ng-template>
                                    </ion-grid>
                                </ion-card-content>
                            </ion-card>
                        </ion-col>
                        <ion-col>
                            <ion-card>
                                <ion-card-content class="background-blueviolet">
                                    <ion-grid class="ion-text-center">
                                        <h2 class="text-white">
                                            Promociones
                                        </h2>
                                        <h1 class="text-white" *ngIf="promotions.length <1; else elseBlock1">
                                            0<!--{{ statistics.totalPromotions }}-->
                                        </h1>
                                        <ng-template #elseBlock1>
                                            <h1 class="text-white">
                                                {{ promotions.length }}<!--{{ statistics.totalPromotions }}-->
                                            </h1>
                                        </ng-template>
                                    </ion-grid>
                                </ion-card-content>
                            </ion-card>
                        </ion-col>
                    </ion-row>
                    <ion-row *ngIf="filter.tipo != null">
                        <h2>Grafica de estadística por {{filter.tipo}}</h2>
                    </ion-row>
                </ion-grid>
            </ion-card-content>
        </ion-card>
        <ion-card>
            <ion-card-header>
                <ion-card-subtitle>Calificaciones</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <ion-grid>
                    <ion-row>
                        <ion-col>
                            <ion-grid class="ion-text-center">
                                <h1>
                                    <strong>
                                        {{statistics.goodGrade}}
                                    </strong>
                                </h1>
                                <ion-text color="success">
                                    <h1>Buena</h1>
                                </ion-text>
                            </ion-grid>
                        </ion-col>
                        <ion-col>
                            <ion-grid class="ion-text-center">
                                <h1>
                                    <strong>
                                        {{statistics.averageRating}}
                                    </strong>
                                </h1>
                                <ion-text color="warning">
                                    <h1>Media</h1>
                                </ion-text>
                            </ion-grid>
                        </ion-col>
                        <ion-col>
                            <ion-grid class="ion-text-center">
                                <h1>
                                    <strong>
                                        {{statistics.lowRating}}
                                    </strong>
                                </h1>
                                <ion-text color="danger">
                                    <h1>Baja</h1>
                                </ion-text>
                            </ion-grid>
                        </ion-col>
                    </ion-row>
                </ion-grid>
            </ion-card-content>
        </ion-card>
        <ion-card *ngIf="totalRequest">
            <ion-card-header>
                <ion-card-subtitle>Vistas de requerimientos de compra</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <ion-list>
                    <ion-item *ngFor="let request of requests"><!--statistics.requests-->
                        <ion-label>{{ request.solicitud }}</ion-label>
                        <ion-badge color="light" slot="end">{{request.cuantos_vieron}}</ion-badge>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>
        <ion-card *ngIf="totalProduct">
            <ion-card-header>
                <ion-card-subtitle>Likes de productos</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <ion-list>
                    <ion-item *ngFor="let product of products"><!--statistics.products-->
                        <ion-label> {{product.producto}} </ion-label>
                        <ion-badge color="light" slot="end">{{product.numero_likes}}</ion-badge>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>
    </div>
    <ng-template #noSuscription>
        <ion-card>
            <ion-card-content>
                <ion-grid>
                    <ion-row>
                        <ion-col>
                            <ion-card>
                                <ion-card-content class="background-deeppink">
                                    <ion-grid class="ion-text-center">
                                        <h2 class="text-white">
                                            No cuentas con la suscripción necesaria para ver las estadísticas 
                                            <!--ion-icon name="information-circle-outline" (click)="noSuscriptionMSG()">
                                            </ion-icon-->
                                        </h2>
                                    </ion-grid>
                                </ion-card-content>
                            </ion-card>
                        </ion-col>                        
                    </ion-row>
                </ion-grid>
            </ion-card-content>
        </ion-card>
    </ng-template>    
</ion-content>
