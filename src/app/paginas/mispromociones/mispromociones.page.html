<ion-header>
  <ion-toolbar>
	<ion-buttons slot="start" (click)="regresar()">
		<ion-icon name="caret-back-circle" style="font-size: 30px;"></ion-icon>
	</ion-buttons>
    <ion-title>Mis promociones</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

	<div style="background-color: white;">

		<div *ngIf="!agregarPromocion">
			<div (click)="agregar()">
				<div style="display: flex; justify-content: center; align-items: center;">
					<ion-icon name="add-circle" style="font-size: 30px; margin-right: 5px;"></ion-icon>
					<p>Agregar promoción</p>
				</div>
			</div>
			<div>
				<div>
					<h3 style="text-align: center;">Mis promociones</h3>
				</div>
				<div>
					<ion-list>
						<div *ngFor="let promocion of lstPromociones" >
							<ion-item (click)="seleccionarPromocion(promocion)">
								<ion-avatar slot="start">
									<img  [src]="promocion.url_imagen" [alt]="promocion.promocion">
								</ion-avatar>
								<ion-label>
									<p>{{promocion.promocion}}</p>
								</ion-label>
							</ion-item>
						</div>
					</ion-list>
				</div>

				<div style="display: flex; justify-content: center; align-items: center; margin-top: 10px;">
					<p>Publicaciones que has realizado</p>
				</div>

				<div style="display: flex; justify-content: center; align-items: center;">
					<p>{{publicacionesHechas}} de {{publicacionesPermitidas}}</p>
				</div>

				<ion-item>
					<ion-label position="floating">Filtrar</ion-label>
					<ion-input placeholder="Promocion o Negocio" (keyup)="btnBuscar()" [(ngModel)]="filtro"></ion-input>
				</ion-item>
				<div *ngIf="lstPromocionesPublicadas !== undefined" style="width: 100%;">
					<ion-slides>
						<ion-slide *ngFor="let promoPubli of lstPromocionesPublicadas">
							<ion-card>
								<ion-card-content>
									<ion-list>
										<ion-item>
											<ion-avatar >
												<img  [src]="promoPubli.url_imagen" [alt]="promoPubli.promocion">
											</ion-avatar>
											<ion-label class="ion-text-wrap" style="margin: 5px;">
												<h2>Usted publicó</h2>
												<h3>{{ promoPubli.promocion }}</h3>
											</ion-label>
										</ion-item>
										<ion-item>
											<ion-label>
												<h2>Negocio</h2>
												<h3>{{ promoPubli.nombre_comercial }}</h3>
											</ion-label>
										</ion-item>
										<ion-item>
											<ion-label>
												<h2>Estatus</h2>
												<h3 *ngIf="promoPubli.activo_public !== 1">No Vigente</h3>
												<h3 *ngIf="promoPubli.activo_public === 1" [ngClass]="{'colorMun': promoPubli.activo_public === 1}">Vigente</h3>
											</ion-label>
										</ion-item>
										<ion-item>
											<ion-label>
												<h2>Fecha de publicación</h2>
												<h3>Del {{promoPubli.fecha_inicio_public}} al {{promoPubli.fecha_fin_public}}</h3>
											</ion-label>
										</ion-item>
									</ion-list>
									<div style="display: flex; justify-content: center; align-items: center;">
										<ion-button type="button" class="btn btn-info" color="warning" (click)="abrirModalDetalle(promoPubli.id_promocion, promoPubli.activo_public)">
											<ion-icon name="eye-outline"></ion-icon>
										  </ion-button>
										  <ion-button type="button" class="btn btn-info" color="danger"  *ngIf="promoPubli.activo_public === 1"  (click)="dejar(promoPubli)">
											despublicar
                      					</ion-button>
									</div>
								</ion-card-content>
							</ion-card>
						</ion-slide>
					</ion-slides>
				</div>
			</div>
		</div>

		<div *ngIf="seleccionaPromocion">

			<div *ngIf="agregarPromocion && !btnDetallePromocion">
				<app-formulario-agregar-promocion [actualTo]="seleccionTO" (_cancelarEdicion)="cancelarEdicion()" (_buscar)="buscar()"></app-formulario-agregar-promocion>
			</div>

		</div>

		<div *ngIf="btnDetallePromocion">
			<ion-card>
				<ion-card-content>
					<div style="display: flex; justify-content: space-between; align-items: center; margin: 10px;">
						<label id="promo{{promocion.id_promocion}}">{{promocion.promocion}}</label>
						<div style="display: flex; justify-content: center; align-items: center; color: grey;" *ngIf="!promocion.activo">
							<p>
								No publicado
							</p>
							<ion-icon name="earth-outline" style="margin-left: 10px; font-size: 30px;"></ion-icon>
						</div>
						<div style="display: flex; justify-content: center; align-items: center; color: blue;" *ngIf="promocion.activo">
							<p>
								Publicado
							</p>
							<ion-icon name="earth-outline" style="margin-left: 10px; font-size: 30px;"></ion-icon>
						</div>
					</div>
					<img src="{{ promocion.url_imagen }}" alt="Falla al cargar imagen" style="width: 100%;">
					<div>
						<p style="text-align: center; color: black;">{{ promocion.terminos }}</p>
					</div>
					<div style="display: flex; justify-content: center; align-items: center;">
						<ion-badge *ngFor="let item of promocion.tags; let i = index" style="margin: 5px 3px;">
							<p *ngIf="item !== undefined && item !== null && item !== ''">{{ item }}</p>
						</ion-badge>
					</div>
					<div style="display: flex; justify-content: center; align-items: center; margin-top: 10px">
						<div style="width: 25%;"  *ngIf="publicacionesHechas<publicacionesPermitidas">
							<ion-button type="button" color="success" expand="full" (click)="abrirModal(promocion)">
								<p style="font-size: 10px;">Publicar</p>
							</ion-button>
						</div>
						<div style="width: 25%;">
							<ion-button type="button" color="warning"  (click)="modificar(promocion)" expand="full">
								<ion-icon name="create-outline"></ion-icon>
							</ion-button>
						</div>
						<div style="width: 25%;" (click)="preguntaEliminar(promocion)" expand="full" >
							<ion-button  type="button"  color="danger" expand="full">
								<ion-icon name="trash-outline"></ion-icon>
							</ion-button>
						</div>
						<div style="width: 25%;">
							<ion-button  type="button"  color="medium" (click)="cancelarEdicion()" expand="full">
								<p style="font-size: 10px;">Cerrar</p>
							</ion-button>
						</div>
					</div>
				</ion-card-content>
			</ion-card>
			
		</div>

	</div>


</ion-content>
